<html>

<head>

  <title>Regexper</title>

  <script src="/assets/raphael-min.js"></script>
  <script src="/assets/microajax.js"></script>
  <script src="/assets/lib.js"></script>
  <script src="/assets/element.js"></script>
  <script src="/assets/container.js"></script>
  <script src="/assets/text.js"></script>
  <script src="/assets/blank.js"></script>
  <script src="/assets/bounding_box.js"></script>
  <script src="/assets/skip_line.js"></script>
  <script src="/assets/hbox.js"></script>
  <script src="/assets/vbox.js"></script>

  <script>
    function drawStructure(id, rexp) {
      Raphael(id, 320, 240, function() {
        var expression, box;

        expression = render(this, rexp.structure);

        expression.stack();
        expression.position(10, 10);

        box = expression.get_box();
        this.setSize(box.width + 20, box.height + 20);
      });
    }
  </script>

</head>

<body>

  <h1>Regexper</h1>

  <form method="POST" action="/parser">
    <input type="text" /><button type="submit">Draw</button>
  </form>

  <div id="error"></div>

  <div id="paper-container"></div>

  <script>
    document.getElementsByTagName("form")[0].onsubmit = function() {
      var svg = document.getElementsByTagName("svg"), i;

      for (i = 0; i < svg.length; i++) {
        svg[i].parentElement.removeChild(svg[i]);
      }

      document.getElementById('error').innerHTML = "";

      new microAjax("/parse", function(text) {
        if (this.request.status == 200) {
          drawStructure("paper-container", JSON.parse(text));
        } else if (this.request.status == 400) {
          document.getElementById("error").innerHTML = JSON.parse(text).error;
        }
      }, document.getElementsByTagName("input")[0].value);

      return false;
    };
  </script>

</body>

</html>
