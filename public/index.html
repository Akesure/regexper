<html>

<head>

  <title>Regexper</title>

</head>

<body>

  <h1>Regexper</h1>

  <form method="POST" action="/parser">
    <input type="text" /><button type="submit">Draw</button>
  </form>

  <div id="error"></div>

  <div id="paper-container"></div>

  <script src="/assets/raphael-min.js"></script>
  <script src="/assets/require.js"></script>
  <script src="/assets/microajax.js"></script>
  <script src="/assets/lib.js"></script>
  <script src="/assets/element.js"></script>
  <script src="/assets/container.js"></script>
  <script src="/assets/text.js"></script>
  <script src="/assets/blank.js"></script>
  <script src="/assets/bounding_box.js"></script>
  <script src="/assets/skip_line.js"></script>
  <script src="/assets/hbox.js"></script>
  <script src="/assets/vbox.js"></script>

  <script>
    require.config({
        baseUrl: '/assets'
    });

    function draw_structure(id, structure) {
        Raphael(id, 320, 240, function() {
            var paper = this;

            require(['regexper'], function(Regexper) {
                Regexper.render(paper, structure, function(expression) {
                    var box;

                    expression.stack();
                    expression.position(10, 10);

                    box = expression.get_box();
                    paper.setSize(box.width + 20, box.height + 20);
                });
            });
        });
    }

    (function() {
      var form = document.getElementsByTagName("form")[0],
        input = form.getElementsByTagName("input")[0],
        error = document.getElementById("error"),
        paper_container = document.getElementById("paper-container");

      form.onsubmit = function() {
        paper_container.innerHTML = "";
        error.innerHTML = "";

        new microAjax("/parse", function(text) {
          if (this.request.status == 200) {
            draw_structure(paper_container, JSON.parse(text).structure);
          } else if (this.request.status == 400) {
            error.innerHTML = JSON.parse(text).error;
          }
        }, input.value);

        return false;
      };
    }());
  </script>

</body>

</html>
